---
layout: post
title: H2 & HSQLDB for Simulating Oracle
date: '2013-12-10T16:22:00.001Z'
author: Robert Elliot
tags: 
modified_time: '2014-01-16T13:43:11.107Z'
blogger_id: tag:blogger.com,1999:blog-8805447266344101474.post-3762527646654832426
blogger_orig_url: http://blog.lidalia.org.uk/2013/12/h2-hsqldb-for-simulating-oracle.html
---

H2 &amp; HSQLDB are two Java in-memory databases. They both offer a degree of support for simulating an Oracle database in your tests. This post describes the pros and cons of each.<br /><br /><h1>H2</h1><h2>How to setup:</h2><br /><pre class="brush:java">import org.h2.Driver;<br />import javax.sql.DataSource;<br />import org.springframework.jdbc.datasource.DriverManagerDataSource;<br /><br />Driver.load();<br />DataSource dataSource = new DriverManagerDataSource(<br />    "jdbc:h2:mem:MYDBNAME;MVCC=true;DB_CLOSE_DELAY=-1;MODE=Oracle",<br />    "sa",<br />    "");<br /></pre><br />DB_CLOSE_DELAY is vital here or the database is deleted whenever the number of connections drops to zero - a highly unintuitive situation.<br /><br /><h2>Pros:</h2>In general I've found I had to make fewer compromises on my SQL syntax in general and my DDL syntax in particular using H2's Oracle compatibility mode. For instance it supports sequences and making the default value of a column a select from a sequence, which HSQLDB does not.<br /><br /><h2>Cons:</h2>The transaction capabilities are not as good as HSQLDB. Specifically, if you use MVCC=true in the connection string then H2 does not support a transaction isolation of serializable, only read committed. If you do not set MVCC=true then a transaction isolation of serializable does work but only by doing a full table lock, which is not at all how Oracle does it.<br /><br /><h1>HSQLDB</h1><h2>How to setup:</h2><pre class="brush:java">import org.hsqldb.jdbc.JDBCDriver;<br />import javax.sql.DataSource;<br />import org.springframework.jdbc.core.JdbcTemplate; <br />import org.springframework.jdbc.datasource.DriverManagerDataSource;<br /><br />JDBCDriver.class.getName();<br />DataSource dataSource = new DriverManagerDataSource(<br />    "jdbc:hsqldb:mem:MYDBNAME",<br />    "sa",<br />    "")<br />JdbcTemplate&nbsp; jdbcTemplate = new JdbcTemplate(dataSource)<br />jdbcTemplate.execute("set database sql syntax ORA TRUE;");<br />jdbcTemplate.execute("set database transaction control MVCC;"); <br /></pre><h2>Pros:</h2>MVCC with a transaction isolation of serializable works as expected - other transactions can continue to write whilst a transaction sees only the state of the DB when it started.<br /><br /><h2>Cons:</h2>Support for Oracle syntax, particularly in DDL, is patchy - I was unable to run the following, which works fine in Oracle:<br /><pre class="brush:sql">CREATE SEQUENCE SQ_TABLE_A;<br />CREATE TABLE TABLE_A (<br />  ID NUMBER(22,0) NOT NULL DEFAULT (SELECT SQ_TABLE_A.NEXTVAL from DUAL),<br />  SOME_DATA NUMBER(22,0) NOT NULL,<br />  TSTAMP TIMESTAMP(3) DEFAULT CURRENT_TIMESTAMP);<br /></pre>